#!/bin/bash

echo "ğŸ”§ å¼ºåˆ¶è®¾ç½®Gradleç”¨æˆ·ç›®å½•..."

# 1. è®¾ç½®ç¯å¢ƒå˜é‡
export GRADLE_USER_HOME="/Users/chenlei/.gradle"
export JAVA_HOME="/Library/Java/JavaVirtualMachines/temurin-17.jdk/Contents/Home"

echo "ğŸ“‚ å¼ºåˆ¶è®¾ç½®GRADLE_USER_HOME: $GRADLE_USER_HOME"
echo "â˜• è®¾ç½®JAVA_HOME: $JAVA_HOME"

# 2. åœ¨gradle.propertiesä¸­å¼ºåˆ¶è®¾ç½®
echo "ğŸ“ åœ¨gradle.propertiesä¸­å¼ºåˆ¶è®¾ç½®Gradleç”¨æˆ·ç›®å½•..."
cat > gradle.properties << 'EOF'
# Project-wide Gradle settings.
org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8

# å¼ºåˆ¶è®¾ç½®Gradleç”¨æˆ·ç›®å½•
org.gradle.user.home=/Users/chenlei/.gradle

# ç½‘ç»œé…ç½®
systemProp.http.proxyHost=
systemProp.http.proxyPort=
systemProp.https.proxyHost=
systemProp.https.proxyPort=

# è¶…æ—¶é…ç½®
systemProp.http.connectionTimeout=60000
systemProp.http.socketTimeout=60000

# AndroidX package structure
android.useAndroidX=true

# Kotlin code style
kotlin.code.style=official

# Enable namespacing
android.nonTransitiveRClass=true

# Gradleé…ç½®
org.gradle.parallel=true
org.gradle.caching=true
org.gradle.configureondemand=true
EOF

# 3. ç¡®ä¿Gradleç”¨æˆ·ç›®å½•å­˜åœ¨å¹¶æœ‰æ­£ç¡®æƒé™
echo "ğŸ“ ç¡®ä¿Gradleç”¨æˆ·ç›®å½•å­˜åœ¨..."
mkdir -p "$GRADLE_USER_HOME"
mkdir -p "$GRADLE_USER_HOME/wrapper/dists"
chmod -R 755 "$GRADLE_USER_HOME"

# 4. æ¸…ç†å¯èƒ½çš„é—®é¢˜æ–‡ä»¶
echo "ğŸ§¹ æ¸…ç†å¯èƒ½çš„é—®é¢˜æ–‡ä»¶..."
rm -rf "$GRADLE_USER_HOME/wrapper/dists/gradle-8.2-bin"

# 5. åˆ›å»ºlocal.propertiesæ–‡ä»¶å¼ºåˆ¶è®¾ç½®
echo "ğŸ“ åˆ›å»ºlocal.propertiesæ–‡ä»¶..."
cat > local.properties << EOF
# This file was automatically generated by Android Studio.
# Do not modify this file -- YOUR CHANGES WILL BE ERASED!
#
# This file should *NOT* be checked into Version Control Systems,
# as it contains information specific to your local configuration.
#
# Location of the SDK. This is only used by Gradle.
# For customization when using a Version Control System, please read the
# header note.
sdk.dir=/Users/chenlei/Library/Android/sdk
EOF

# 6. åœæ­¢æ‰€æœ‰Gradleå®ˆæŠ¤è¿›ç¨‹
echo "ğŸ›‘ åœæ­¢æ‰€æœ‰Gradleå®ˆæŠ¤è¿›ç¨‹..."
./gradlew --stop 2>/dev/null || true

# 7. è®¾ç½®ç¯å¢ƒå˜é‡å¹¶å°è¯•æ„å»º
echo "ğŸš€ å°è¯•æ„å»ºé¡¹ç›®..."
export GRADLE_USER_HOME="/Users/chenlei/.gradle"
export JAVA_HOME="/Library/Java/JavaVirtualMachines/temurin-17.jdk/Contents/Home"
export PATH="$JAVA_HOME/bin:$PATH"

echo "ç¯å¢ƒå˜é‡éªŒè¯:"
echo "GRADLE_USER_HOME=$GRADLE_USER_HOME"
echo "JAVA_HOME=$JAVA_HOME"

# å°è¯•æ„å»º
./gradlew clean --info





